<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Running Guardium Insights with QSPM on EC2">

<title>OpenShift Installation – IBM Quantum Safe Encryption</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/bee.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-0e5edbee8f245697e4c7aae403c32e64.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": true,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "Search",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../images/IBMlogo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">IBM Quantum Safe Encryption</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/ibm-client-engineering">
 <span class="dropdown-text">Check us out on Github</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.ibm.com/ibm-client-engineering/solution-journal-quantum-safe">
 <span class="dropdown-text">Look at this repo on Github</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-linkedin" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-linkedin">    
        <li>
    <a class="dropdown-item" href="http://linkedin.com/post">
 <span class="dropdown-text">Share on your LinkedIn</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.linkedin.com/company/ibm/">
 <span class="dropdown-text">IBM LinkedIn</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#prepare-the-bastion-node" id="toc-prepare-the-bastion-node" class="nav-link active" data-scroll-target="#prepare-the-bastion-node">Prepare the Bastion Node</a></li>
  <li><a href="#setup-services" id="toc-setup-services" class="nav-link" data-scroll-target="#setup-services">Setup Services</a></li>
  <li><a href="#setup-local-and-internal-registries" id="toc-setup-local-and-internal-registries" class="nav-link" data-scroll-target="#setup-local-and-internal-registries">Setup Local and Internal registries</a></li>
  <li><a href="#start-cluster-creation" id="toc-start-cluster-creation" class="nav-link" data-scroll-target="#start-cluster-creation">Start cluster creation</a></li>
  <li><a href="#nfs-provisioner-setup" id="toc-nfs-provisioner-setup" class="nav-link" data-scroll-target="#nfs-provisioner-setup">NFS Provisioner setup</a>
  <ul class="collapse">
  <li><a href="#creating-the-efs-filesystem" id="toc-creating-the-efs-filesystem" class="nav-link" data-scroll-target="#creating-the-efs-filesystem">Creating the EFS filesystem</a></li>
  <li><a href="#deploying-the-provisioner-with-a-yaml" id="toc-deploying-the-provisioner-with-a-yaml" class="nav-link" data-scroll-target="#deploying-the-provisioner-with-a-yaml">Deploying the provisioner with a yaml</a></li>
  <li><a href="#deploying-the-provisioner-with-helm" id="toc-deploying-the-provisioner-with-helm" class="nav-link" data-scroll-target="#deploying-the-provisioner-with-helm">Deploying the provisioner with helm</a></li>
  <li><a href="#install-to-ocp" id="toc-install-to-ocp" class="nav-link" data-scroll-target="#install-to-ocp">Install to OCP</a></li>
  <li><a href="#install-the-helm-chart-and-run-the-helm-install" id="toc-install-the-helm-chart-and-run-the-helm-install" class="nav-link" data-scroll-target="#install-the-helm-chart-and-run-the-helm-install">Install the helm chart and run the helm install</a></li>
  </ul></li>
  <li><a href="#change-cluster-domain" id="toc-change-cluster-domain" class="nav-link" data-scroll-target="#change-cluster-domain">Change Cluster Domain</a>
  <ul class="collapse">
  <li><a href="#generate-new-self-signed-certificate" id="toc-generate-new-self-signed-certificate" class="nav-link" data-scroll-target="#generate-new-self-signed-certificate">Generate new self-signed certificate</a></li>
  </ul></li>
  <li><a href="#increase-primary-disk-size-on-worker-nodes" id="toc-increase-primary-disk-size-on-worker-nodes" class="nav-link" data-scroll-target="#increase-primary-disk-size-on-worker-nodes">Increase Primary Disk size on worker nodes:</a></li>
  <li><a href="#add-users-to-openshift-using-htpassword" id="toc-add-users-to-openshift-using-htpassword" class="nav-link" data-scroll-target="#add-users-to-openshift-using-htpassword">Add users to OpenShift using HTPassword</a>
  <ul class="collapse">
  <li><a href="#install-http-tools" id="toc-install-http-tools" class="nav-link" data-scroll-target="#install-http-tools">Install HTTP Tools:</a></li>
  <li><a href="#create-a-htpassword-file" id="toc-create-a-htpassword-file" class="nav-link" data-scroll-target="#create-a-htpassword-file">Create a HTPassword File:</a></li>
  <li><a href="#create-the-htpassword-secret" id="toc-create-the-htpassword-secret" class="nav-link" data-scroll-target="#create-the-htpassword-secret">Create the HTPassword secret:</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">OpenShift Installation</h1>
</div>

<div>
  <div class="description">
    Running Guardium Insights with QSPM on EC2
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="prepare-the-bastion-node" class="level3">
<h3 class="anchored" data-anchor-id="prepare-the-bastion-node">Prepare the Bastion Node</h3>
<section id="update-the-os-and-install-additional-tools" class="level4">
<h4 class="anchored" data-anchor-id="update-the-os-and-install-additional-tools">Update the OS and install additional tools</h4>
<pre><code>sudo yum update -y; sudo yum install git -y</code></pre>
</section>
<section id="clone-the-repository-to-the-bootnode." class="level4">
<h4 class="anchored" data-anchor-id="clone-the-repository-to-the-bootnode.">Clone the repository to the bootnode.</h4>
<pre><code>git clone https://github.com/ibm-client-engineering/engineering-journal-quantum-safe</code></pre>
</section>
<section id="run-setup_bastion-script" class="level4">
<h4 class="anchored" data-anchor-id="run-setup_bastion-script">Run ‘setup_bastion’ script</h4>
<p>Run the ‘setup_bastion’ script which will install additional tools, and configure an HTTP server to host the Bootstrap ignition file.</p>
<pre><code>cd $HOME/aws-openshift410-cloudformation-noIAM-noR53/utils
./setup_bastion.sh</code></pre>
</section>
<section id="change-the-bootnode-hostname-to-registry.domain" class="level4">
<h4 class="anchored" data-anchor-id="change-the-bootnode-hostname-to-registry.domain">Change the bootnode hostname to ‘registry.$DOMAIN’</h4>
<pre><code>sudo hostnamectl set-hostname registry.$DOMAIN.com
sudo reboot</code></pre>
</section>
</section>
<section id="setup-services" class="level3">
<h3 class="anchored" data-anchor-id="setup-services">Setup Services</h3>
<section id="create-registry" class="level4">
<h4 class="anchored" data-anchor-id="create-registry">Create Registry</h4>
<p>Create a new directory for the registry, select a port (suggested port: 5000), a username and a password.</p>
<pre><code>sudo mkdir -p /ibm/
sudo chown -R ec2-user:ec2-user /ibm/
./create_registry.sh &lt;registry_directory&gt; &lt;port&gt; &lt;userid&gt; &lt;password&gt; &lt;local_dir_install&gt;</code></pre>
<p>Example:</p>
<pre><code>./create_registry.sh /ibm 5000 wxai CeFsm2024 /home/ec2-user/openshift-upi-master/aws-openshift410-cloudformation-noIAM-noR53</code></pre>
</section>
<section id="start-the-registry" class="level4">
<h4 class="anchored" data-anchor-id="start-the-registry">Start the registry</h4>
<pre><code>./start_registry.sh &lt;registry_directory&gt; &lt;port&gt;</code></pre>
<p>Example:</p>
<pre><code>./start_registry.sh /ibm 5000</code></pre>
</section>
<section id="add-your-local-registry-login-details" class="level4">
<h4 class="anchored" data-anchor-id="add-your-local-registry-login-details">Add your local registry login details</h4>
<pre><code>mkdir -p /ibm/security/auth/</code></pre>
<pre><code>echo -n '&lt;user_name&gt;:&lt;password&gt;' | base64 -w0 </code></pre>
</section>
<section id="add-your-details-to-the-auth.json" class="level4">
<h4 class="anchored" data-anchor-id="add-your-details-to-the-auth.json">Add your details to the auth.json</h4>
<pre><code>{
  "auths": {
    "&lt;mirror_registry&gt;": { 
      "auth": "&lt;credentials&gt;", 
      "email": "you@example.com"
    }
  }
}</code></pre>
<pre><code>&lt;mirror_registry&gt; - the URL of the registry including the port
&lt;credentials&gt; - the output from "echo -n '&lt;user_name&gt;:&lt;password&gt;' | base64 -w0 "</code></pre>
<p>Confirm the registry is accessible:</p>
<pre><code>podman login &lt;Registry_URL&gt; --authfile /ibm/security/auth/auth.json</code></pre>
</section>
</section>
<section id="setup-local-and-internal-registries" class="level3">
<h3 class="anchored" data-anchor-id="setup-local-and-internal-registries">Setup Local and Internal registries</h3>
<section id="load-the-registry-with-the-ocp-files" class="level4">
<h4 class="anchored" data-anchor-id="load-the-registry-with-the-ocp-files">Load the registry with the OCP files</h4>
<pre><code>./load_ocp.sh &lt;ocprelease&gt; &lt;registryip:port&gt; &lt;contentpath&gt; &lt;authfile&gt;</code></pre>
<p>Example:</p>
<pre><code>./load_ocp.sh 4.14.9 registry.cpdu8vscs.ibmworkshops.com:5000 /ibm/openshift-4.14.9/export /ibm/openshift/auth.json</code></pre>
<pre><code>export OCP_RELEASE="4.14.9"

export LOCAL_REGISTRY="registry.cpdu8vscs.ibmworkshops.com:5000"

export LOCAL_REPOSITORY="openshift"

export PRODUCT_REPO="openshift-release-dev"

export RELEASE_NAME="ocp-release"

export ARCHITECTURE="x86_64"

export REMOVABLE_MEDIA_PATH="/ibm/ocp-images"

export LOCAL_SECRET_JSON="/ibm/openshift/auth.json"

</code></pre>
<p>Review images and configurations</p>
<pre><code>oc adm release mirror -a ${LOCAL_SECRET_JSON} --from=quay.io/${PRODUCT_REPO}/${RELEASE_NAME}:${OCP_RELEASE}-${ARCHITECTURE} --to=${LOCAL_REGISTRY}/${LOCAL_REPOSITORY} --to-release-image=${LOCAL_REGISTRY}/${LOCAL_REPOSITORY}:${OCP_RELEASE}-${ARCHITECTURE} --dry-run</code></pre>
<p>Pull down images and send to local registry.</p>
<pre><code>oc image mirror -a ${LOCAL_SECRET_JSON} --from-dir=${REMOVABLE_MEDIA_PATH}/mirror "file://openshift/release:${OCP_RELEASE}*" ${LOCAL_REGISTRY}/${LOCAL_REPOSITORY} </code></pre>
</section>
<section id="extract-the-openshift-installer" class="level4">
<h4 class="anchored" data-anchor-id="extract-the-openshift-installer">Extract the OpenShift Installer</h4>
<p>Generate the openshift-install binary for the version of openshift images that were pulled.</p>
<pre><code>oc adm release extract -a ${LOCAL_SECRET_JSON} --command=openshift-install "${LOCAL_REGISTRY}/${LOCAL_REPOSITORY}:${OCP_RELEASE}-${ARCHITECTURE}"</code></pre>
<p>Move openshift-install to /usr/bin.</p>
<pre><code>sudo mv openshift-install /usr/bin/openshift-install</code></pre>
</section>
</section>
<section id="start-cluster-creation" class="level3">
<h3 class="anchored" data-anchor-id="start-cluster-creation">Start cluster creation</h3>
<section id="collect-information-for-config.sh" class="level4">
<h4 class="anchored" data-anchor-id="collect-information-for-config.sh">Collect information for ‘config.sh’</h4>
<p>Information needed to update ‘config.sh’</p>
<pre><code>Cluster Name
Base Domain
Registry URL
Local Pull Secret updated with local registry auth.
Additional Trust certs generated during the registry creation process.
AWS Region
AWS Private Subnets
AWS VPC ID
AWS VPC CIDR
AWS RHCOS AMI ID

Bootstrap allowed SSH CIDR
Bootstrap Ignition URL (Bastion node's hostname, port, and file name)
Master Instance Type
Worker Count
Worker Instance Type</code></pre>
<p>****Important Node: AWS CLI will need to be configured, and output format MUST be json</p>
</section>
<section id="start-the-installation" class="level4">
<h4 class="anchored" data-anchor-id="start-the-installation">Start the installation</h4>
<p>After updating config.sh, run “create_cluster_step_1.sh”.</p>
<pre><code>./create_cluster_step_1.sh</code></pre>
<p>Once this completes, create the DNS records listed in the script output:</p>
<pre><code>api.{ClusterName}.{DOMAINNAME} -&gt; wxai-int-(random_string).elb.us-east-2.amazonaws.com
api-int.{ClusterName}.{DOMAINNAME} -&gt; wxai-int-(random_string).elb.us-east-2.amazonaws.com
*.apps.{ClusterName}.{DOMAINNAME} -&gt; wxai-int-(random_string).elb.us-east-2.amazonaws.com</code></pre>
<p>Now run step 2:</p>
<pre><code>./create_cluster_step_2.sh</code></pre>
</section>
</section>
<section id="nfs-provisioner-setup" class="level2">
<h2 class="anchored" data-anchor-id="nfs-provisioner-setup">NFS Provisioner setup</h2>
<div class="note">
<p>In a user managed instance of OCP on AWS, the EFS provisioner from AWS is not available. In our case we will be provisioning an EFS share, and then installing the NFS provioner to the cluster.2a</p>
</div>
<section id="creating-the-efs-filesystem" class="level3">
<h3 class="anchored" data-anchor-id="creating-the-efs-filesystem">Creating the EFS filesystem</h3>
<p>Create an AWS Elastic File System with the following commands:</p>
<pre><code>export CREATION_TOKEN='ibm-wxai-token'
aws efs create-file-system --creation-token ${CREATION_TOKEN} --encrypted --backup --performance-mode generalPurpose --throughput-mode elastic --region us-east-2 --tags Key=key,Value=value Key=key1,Value=value1</code></pre>
<p>Set the Subnet IDs and Worker Security Group ID variables:</p>
<pre><code>export SUBNET_ID_1="US-EAST-2a Subnet ID"
export SUBNET_ID_2="US-EAST-2b Subnet ID"
export SUBNET_ID_3="US-EAST-2c Subnet ID"
export WORKER_SG="Worker Security Group ID"
export EFS_ID=$(aws efs describe-file-systems --creation-token ${CREATION_TOKEN} | jq '.FileSystems[] | ."FileSystemId"'| tr -d '"')</code></pre>
<section id="create-mount-targets" class="level4">
<h4 class="anchored" data-anchor-id="create-mount-targets">Create mount targets:</h4>
<p>Run the following commands to create mount targets that include the three subnets used by the worker nodes:</p>
<pre><code>aws efs create-mount-target --file-system-id ${EFS_ID} --subnet-id  ${SUBNET_ID_1} --security-group ${WORKER_SG_ID} --region us-east-2
aws efs create-mount-target --file-system-id ${EFS_ID} --subnet-id  ${SUBNET_ID_2} --security-group ${WORKER_SG_ID} --region us-east-2
aws efs create-mount-target --file-system-id ${EFS_ID} --subnet-id  ${SUBNET_ID_3} --security-group ${WORKER_SG_ID} --region us-east-2</code></pre>
</section>
</section>
<section id="deploying-the-provisioner-with-a-yaml" class="level3">
<h3 class="anchored" data-anchor-id="deploying-the-provisioner-with-a-yaml">Deploying the provisioner with a yaml</h3>
<section id="download-nfs-provisioner.yml" class="level4">
<h4 class="anchored" data-anchor-id="download-nfs-provisioner.yml">Download nfs-provisioner.yml</h4>
<p>Download the nfs-provisioner.yml file from here:</p>
<p>https://raw.githubusercontent.com/ibm-client-engineering/engineering-journal-quantum-safe/main/public/scripts/nfs_provisioner.yml</p>
<p>Confirm that the “EFS_ID” is properly set from the previous step:</p>
<pre><code>echo $EFS_ID</code></pre>
<p>Then update the ‘nfs_provisioner.yml’ to use the new EFS ID:</p>
<pre><code>sed -i "s/EFS_ID/${EFS_ID}/g" nfs_provisioner.yml</code></pre>
</section>
<section id="apply-nfs_provisioner.yml" class="level4">
<h4 class="anchored" data-anchor-id="apply-nfs_provisioner.yml">Apply nfs_provisioner.yml</h4>
<p>Now create the nfs_provisioner in the cluster:</p>
<pre><code>oc create -f nfs_provisioner.yml</code></pre>
</section>
</section>
<section id="deploying-the-provisioner-with-helm" class="level3">
<h3 class="anchored" data-anchor-id="deploying-the-provisioner-with-helm">Deploying the provisioner with helm</h3>
<section id="installing-helm" class="level4">
<h4 class="anchored" data-anchor-id="installing-helm">Installing helm</h4>
<p>Verify and/or install openssl</p>
<pre class="tsx"><code>sudo dnf -y install openssl</code></pre>
<p>Run the following commands to install helm to the bastion host</p>
<pre class="tsx"><code>curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
chmod +x get_helm.sh
./get_helm.sh

Downloading https://get.helm.sh/helm-v3.14.3-linux-amd64.tar.gz
Verifying checksum... Done.
Preparing to install helm into /usr/local/bin
helm installed into /usr/local/bin/helm</code></pre>
<p>Verify helm is available</p>
<pre class="tsx"><code>helm

The Kubernetes package manager

Common actions for Helm:

- helm search:    search for charts
- helm pull:      download a chart to your local directory to view
- helm install:   upload the chart to Kubernetes
- helm list:      list releases of charts

Environment variables:

| Name                               | Description                                                                                                |
|------------------------------------|------------------------------------------------------------------------------------------------------------|
| $HELM_CACHE_HOME                   | set an alternative location for storing cached files.                                                      |
| $HELM_CONFIG_HOME                  | set an alternative location for storing Helm configuration.                                                |
| $HELM_DATA_HOME                    | set an alternative location for storing Helm data.                                                         |
| $HELM_DEBUG                        | indicate whether or not Helm is running in Debug mode                                                      |
| $HELM_DRIVER                       | set the backend storage driver. Values are: configmap, secret, memory, sql.                                |
| $HELM_DRIVER_SQL_CONNECTION_STRING | set the connection string the SQL storage driver should use.                                               |
| $HELM_MAX_HISTORY                  | set the maximum number of helm release history.                                                            |
| $HELM_NAMESPACE                    | set the namespace used for the helm operations.                                                            |
| $HELM_NO_PLUGINS                   | disable plugins. Set HELM_NO_PLUGINS=1 to disable plugins.                                                 |
| $HELM_PLUGINS                      | set the path to the plugins directory                                                                      |
| $HELM_REGISTRY_CONFIG              | set the path to the registry config file.                                                                  |
| $HELM_REPOSITORY_CACHE             | set the path to the repository cache directory                                                             |
| $HELM_REPOSITORY_CONFIG            | set the path to the repositories file.                                                                     |
| $KUBECONFIG                        | set an alternative Kubernetes configuration file (default "~/.kube/config")                                |
| $HELM_KUBEAPISERVER                | set the Kubernetes API Server Endpoint for authentication                                                  |
| $HELM_KUBECAFILE                   | set the Kubernetes certificate authority file.                                                             |
| $HELM_KUBEASGROUPS                 | set the Groups to use for impersonation using a comma-separated list.                                      |
| $HELM_KUBEASUSER                   | set the Username to impersonate for the operation.                                                         |
| $HELM_KUBECONTEXT                  | set the name of the kubeconfig context.                                                                    |
| $HELM_KUBETOKEN                    | set the Bearer KubeToken used for authentication.                                                          |
| $HELM_KUBEINSECURE_SKIP_TLS_VERIFY | indicate if the Kubernetes API server's certificate validation should be skipped (insecure)                |
| $HELM_KUBETLS_SERVER_NAME          | set the server name used to validate the Kubernetes API server certificate                                 |
| $HELM_BURST_LIMIT                  | set the default burst limit in the case the server contains many CRDs (default 100, -1 to disable)         |
| $HELM_QPS                          | set the Queries Per Second in cases where a high number of calls exceed the option for higher burst values |

Helm stores cache, configuration, and data based on the following configuration order:

- If a HELM_*_HOME environment variable is set, it will be used
- Otherwise, on systems supporting the XDG base directory specification, the XDG variables will be used
- When no other location is set a default location will be used based on the operating system

By default, the default directories depend on the Operating System. The defaults are listed below:

| Operating System | Cache Path                | Configuration Path             | Data Path               |
|------------------|---------------------------|--------------------------------|-------------------------|
| Linux            | $HOME/.cache/helm         | $HOME/.config/helm             | $HOME/.local/share/helm |
| macOS            | $HOME/Library/Caches/helm | $HOME/Library/Preferences/helm | $HOME/Library/helm      |
| Windows          | %TEMP%\helm               | %APPDATA%\helm                 | %APPDATA%\helm          |

Usage:
  helm [command]

Available Commands:
  completion  generate autocompletion scripts for the specified shell
  create      create a new chart with the given name
  dependency  manage a chart's dependencies
  env         helm client environment information
  get         download extended information of a named release
  help        Help about any command
  history     fetch release history
  install     install a chart
  lint        examine a chart for possible issues
  list        list releases
  package     package a chart directory into a chart archive
  plugin      install, list, or uninstall Helm plugins
  pull        download a chart from a repository and (optionally) unpack it in local directory
  push        push a chart to remote
  registry    login to or logout from a registry
  repo        add, list, remove, update, and index chart repositories
  rollback    roll back a release to a previous revision
  search      search for a keyword in charts
  show        show information of a chart
  status      display the status of the named release
  template    locally render templates
  test        run tests for a release
  uninstall   uninstall a release
  upgrade     upgrade a release
  verify      verify that a chart at the given path has been signed and is valid
  version     print the client version information

Flags:
      --burst-limit int                 client-side default throttling limit (default 100)
      --debug                           enable verbose output
  -h, --help                            help for helm
      --kube-apiserver string           the address and the port for the Kubernetes API server
      --kube-as-group stringArray       group to impersonate for the operation, this flag can be repeated to specify multiple groups.
      --kube-as-user string             username to impersonate for the operation
      --kube-ca-file string             the certificate authority file for the Kubernetes API server connection
      --kube-context string             name of the kubeconfig context to use
      --kube-insecure-skip-tls-verify   if true, the Kubernetes API server's certificate will not be checked for validity. This will make your HTTPS connections insecure
      --kube-tls-server-name string     server name to use for Kubernetes API server certificate validation. If it is not provided, the hostname used to contact the server is used
      --kube-token string               bearer token used for authentication
      --kubeconfig string               path to the kubeconfig file
  -n, --namespace string                namespace scope for this request
      --qps float32                     queries per second used when communicating with the Kubernetes API, not including bursting
      --registry-config string          path to the registry config file (default "/home/kramerro/.config/helm/registry/config.json")
      --repository-cache string         path to the file containing cached repository indexes (default "/home/kramerro/.cache/helm/repository")
      --repository-config string        path to the file containing repository names and URLs (default "/home/kramerro/.config/helm/repositories.yaml")

Use "helm [command] --help" for more information about a command.</code></pre>
</section>
</section>
<section id="install-to-ocp" class="level3">
<h3 class="anchored" data-anchor-id="install-to-ocp">Install to OCP</h3>
<p>From the OC cli:</p>
<pre class="tsx"><code>oc new-project nfs-provisioner

Now using project "nfs-provisioner" on server "https://api.wxai.cpdu8vscs.ibmworkshops.com:6443".

You can add applications to this project with the 'new-app' command. For example, try:

    oc new-app rails-postgresql-example

to build a new example application in Ruby. Or use kubectl to deploy a simple Kubernetes application:

    kubectl create deployment hello-node --image=registry.k8s.io/e2e-test-images/agnhost:2.43 -- /agnhost serve-hostname</code></pre>
<p>This will automatically put you in that project.</p>
<p>Now set up the SCCs</p>
<pre class="tsx"><code>oc apply -f - &lt;&lt;EOF
allowHostDirVolumePlugin: true
allowHostIPC: false
allowHostNetwork: false
allowHostPID: false
allowHostPorts: false
allowPrivilegeEscalation: true
allowPrivilegedContainer: false
allowedCapabilities: null
apiVersion: security.openshift.io/v1
defaultAddCapabilities: null
fsGroup:
  type: RunAsAny
groups: []
kind: SecurityContextConstraints
metadata:
  annotations:
    kubernetes.io/description: 'hostmount-anyuid provides all the features of the
      restricted SCC but allows host mounts and any UID by a pod.  This is primarily
      used by the persistent volume recycler. WARNING: this SCC allows host file system
      access as any UID, including UID 0.  Grant with caution.'
  name: nfs-storage-hostmount-anyuid
readOnlyRootFilesystem: false
requiredDropCapabilities:
- MKNOD
runAsUser:
  type: RunAsAny
seLinuxContext:
  type: MustRunAs
supplementalGroups:
  type: RunAsAny
users:
- system:serviceaccount:nfs-provisioner:nfs-subdir-external-provisioner
volumes:
- configMap
- downwardAPI
- emptyDir
- hostPath
- nfs
- persistentVolumeClaim
- projected
- secret
EOF</code></pre>
<p>output:</p>
<pre class="tsx"><code>securitycontextconstraints.security.openshift.io/nfs-storage-hostmount-anyuid created</code></pre>
</section>
<section id="install-the-helm-chart-and-run-the-helm-install" class="level3">
<h3 class="anchored" data-anchor-id="install-the-helm-chart-and-run-the-helm-install">Install the helm chart and run the helm install</h3>
<p>The <code>&lt;EFS URL&gt;</code> should be returned by the aws cli creation of the EFS storage filesystem.</p>
<pre class="tsx"><code>helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/
helm install nfs-subdir-external-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \
    --namespace nfs-provisioner \
    --set nfs.server=&lt;EFS URL&gt;\
    --set nfs.path=/ \
    --set storageClass.defaultClass=true</code></pre>
<p>Verify the pods are up</p>
<pre class="tsx"><code>oc get pods</code></pre>
<p><em>EXAMPLE RETURNED OUTPUT HERE</em></p>
<p>Make sure the storage class now exists and is set to default</p>
<pre class="tsx"><code>oc get sc</code></pre>
<p>Verify that the storage will provision with the following test deployment</p>
<pre class="tsx"><code>oc apply -f - &lt;&lt;EOF
kind: Pod
apiVersion: v1
metadata:
  name: test-pod
spec:
  containers:
  - name: test-pod
    image: busybox:stable
    command:
      - "/bin/sh"
    args:
      - "-c"
      - "touch /mnt/SUCCESS &amp;&amp; exit 0 || exit 1"
    volumeMounts:
      - name: nfs-pvc
        mountPath: "/mnt"
  restartPolicy: "Never"
  volumes:
    - name: nfs-pvc
      persistentVolumeClaim:
        claimName: test-claim
---
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: test-claim
spec:
  storageClassName: nfs-client
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 1Mi
EOF
</code></pre>
</section>
</section>
<section id="change-cluster-domain" class="level2">
<h2 class="anchored" data-anchor-id="change-cluster-domain">Change Cluster Domain</h2>
<section id="generate-new-self-signed-certificate" class="level3">
<h3 class="anchored" data-anchor-id="generate-new-self-signed-certificate">Generate new self-signed certificate</h3>
<section id="generate-ca-certs" class="level4">
<h4 class="anchored" data-anchor-id="generate-ca-certs">Generate CA certs</h4>
<pre><code>openssl genrsa -out ca.key 2048

openssl req -new -x509 -days 365 -key ca.key -subj "/C=CN/ST=GD/L=SZ/O=Acme, Inc./CN=Acme Root CA" -out ca.crt
</code></pre>
</section>
<section id="generate-server-certs" class="level4">
<h4 class="anchored" data-anchor-id="generate-server-certs">Generate Server certs</h4>
<p>Generate ‘server.csr’</p>
<pre><code>openssl req -newkey rsa:2048 -nodes -keyout server.key -subj "/C=CN/ST=GD/L=SZ/O=Acme, Inc./CN=*.{BASE_DOMAIN}" -out server.csr</code></pre>
<p>Generate ‘server.crt’</p>
<pre><code>openssl x509 -req -extfile &lt;(printf "subjectAltName=DNS:*.{BASE_DOMAIN}") -days 365 -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt</code></pre>
</section>
<section id="update-the-cluster" class="level4">
<h4 class="anchored" data-anchor-id="update-the-cluster">Update the cluster:</h4>
<p>Create the new secret which will contain the cert and key:</p>
<pre><code>oc create secret tls custom-cert --cert=server.crt --key=server.key -n openshift-config</code></pre>
<p>Update the ingress:</p>
<pre><code>oc edit ingresses.config/cluster -o yaml</code></pre>
<p>Add the following under ‘spec:’</p>
<pre><code>  componentRoutes:
  - hostname: console.{NEW_URL}
    name: console
    namespace: openshift-console
    servingCertKeyPairSecret:
      name: custom-cert
  - hostname: oauth.{NEW_URL}
    name: oauth-openshift
    namespace: openshift-authentication
    servingCertKeyPairSecret:
      name: custom-cert</code></pre>
</section>
</section>
</section>
<section id="increase-primary-disk-size-on-worker-nodes" class="level2">
<h2 class="anchored" data-anchor-id="increase-primary-disk-size-on-worker-nodes">Increase Primary Disk size on worker nodes:</h2>
<ol type="1">
<li>Run the following bash one-liner to increase the primary disk on all worker nodes to 500GB:</li>
</ol>
<pre><code>aws ec2 describe-instances --query 'Reservations[*].Instances[*].[InstanceId,Tags[?Key==`Name`].Value|[0],BlockDeviceMappings[0].Ebs.VolumeId]' --output text | grep worker | awk '{print $3}' | while read volume_id; do aws ec2 modify-volume --volume-id $volume_id --size 500; done</code></pre>
<ol start="2" type="1">
<li>Log into the node with following command:</li>
</ol>
<pre><code>oc debug node/&lt;node_name&gt;</code></pre>
<ol start="3" type="1">
<li>Once in the node, run the following:</li>
</ol>
<pre><code>chroot /host</code></pre>
<p>then:</p>
<pre><code>sudo lsblk</code></pre>
<p>The output should look like this:</p>
<pre><code># sudo lsblk
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
nvme1n1     259:0    0     1T  0 disk
nvme0n1     259:1    0   500G  0 disk
|-nvme0n1p1 259:2    0     1M  0 part
|-nvme0n1p2 259:3    0   127M  0 part
|-nvme0n1p3 259:4    0   384M  0 part /boot
`-nvme0n1p4 259:5    0 239.5G  0 part /var/lib/kubelet/pods/555d6f90-41fd-49d2-8aad-fa7293a924e4/volume-subpaths/app-config-override/wd-discovery-cnm-api/2
                                      /var/lib/kubelet/pods/57d28f73-d355-4092-8e52-6b6aeec28bd5/volume-subpaths/clouseau-config/search/4
                                      /var/lib/kubelet/pods/fcb4b5ec-ea1a-42c7-908c-a027cf885ca1/volume-subpaths/db2wh-cm/zen-database-core/1
                                      /var/lib/kubelet/pods/fcb4b5ec-ea1a-42c7-908c-a027cf885ca1/volume-subpaths/db2oltp-cm/zen-database-core/0
                                      /var/lib/kubelet/pods/5e35fe3f-7e4d-4729-b3dd-b9553ffd73f6/volume-subpaths/nginx-conf/monitoring-plugin/1
                                      /var
                                      /sysroot/ostree/deploy/rhcos/var
                                      /sysroot
                                      /usr
                                      /etc
                                      /
</code></pre>
<ol start="4" type="1">
<li>Find the part on the disk that you wish to increase, in my case it was ‘nvme0n1p4’.</li>
</ol>
<p>Now we extend the partition, by targeting the disk (Example: /dev/nvme0n1) and the partition (Example: 4)</p>
<pre><code>sudo growpart /dev/nvme0n1 4</code></pre>
<ol start="5" type="1">
<li>Check the disk sizes again:</li>
</ol>
<pre><code>sudo lsblk</code></pre>
<p>This is what my output looks like now:</p>
<pre><code>NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
nvme1n1     259:0    0     1T  0 disk
nvme0n1     259:1    0   500G  0 disk
|-nvme0n1p1 259:2    0     1M  0 part
|-nvme0n1p2 259:3    0   127M  0 part
|-nvme0n1p3 259:4    0   384M  0 part /boot
`-nvme0n1p4 259:5    0 499.5G  0 part /var/lib/kubelet/pods/555d6f90-41fd-49d2-8aad-fa7293a924e4/volume-subpaths/app-config-override/wd-discovery-cnm-api/2
                                      /var/lib/kubelet/pods/57d28f73-d355-4092-8e52-6b6aeec28bd5/volume-subpaths/clouseau-config/search/4
                                      /var/lib/kubelet/pods/fcb4b5ec-ea1a-42c7-908c-a027cf885ca1/volume-subpaths/db2wh-cm/zen-database-core/1
                                      /var/lib/kubelet/pods/fcb4b5ec-ea1a-42c7-908c-a027cf885ca1/volume-subpaths/db2oltp-cm/zen-database-core/0
                                      /var/lib/kubelet/pods/5e35fe3f-7e4d-4729-b3dd-b9553ffd73f6/volume-subpaths/nginx-conf/monitoring-plugin/1
                                      /var
                                      /sysroot/ostree/deploy/rhcos/var
                                      /sysroot
                                      /usr
                                      /etc
                                      /</code></pre>
<ol start="6" type="1">
<li>Last step is to extend the file system:</li>
</ol>
<pre><code>sudo xfs_growfs -d /</code></pre>
</section>
<section id="add-users-to-openshift-using-htpassword" class="level2">
<h2 class="anchored" data-anchor-id="add-users-to-openshift-using-htpassword">Add users to OpenShift using HTPassword</h2>
<section id="install-http-tools" class="level3">
<h3 class="anchored" data-anchor-id="install-http-tools">Install HTTP Tools:</h3>
<pre><code>yum install httpd-tools</code></pre>
</section>
<section id="create-a-htpassword-file" class="level3">
<h3 class="anchored" data-anchor-id="create-a-htpassword-file">Create a HTPassword File:</h3>
<p>Run the following command to create the HTPassword file that will be used by OpenShift.</p>
<pre><code>htpassword -c &lt;file_name&gt; &lt;username&gt;</code></pre>
<p>After running the command, you will be prompted for a password and then asked to confirm password.</p>
</section>
<section id="create-the-htpassword-secret" class="level3">
<h3 class="anchored" data-anchor-id="create-the-htpassword-secret">Create the HTPassword secret:</h3>
<pre><code>oc create secret generic htpasswd-secret --from-file=htpasswd=&lt;file_name&gt; -n openshift-config</code></pre>
</section>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section"></h3>
<p>Edit the OpenShift OAuth settings:</p>
<pre><code>oc edit oauth cluster</code></pre>
<p>Then add the following to the file:</p>
<pre><code>spec:
  identityProviders:
  - name: my_htpasswd_provider
    mappingMethod: claim
    type: HTPasswd
    htpasswd:
      fileData:
        name: htpasswd-secret</code></pre>
<p>After this has been added, try opening Openshift in a private browser, and select ‘HTPasswd’. Then enter the username and password.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ibm-client-engineering\.github\.io\/solution-journal-quantum-safe\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<div class="listitem">
<a href="https://ibm.com" rel="noopener noreferrer" class="footerLogo"><img src="https://www.ibm.com/brand/experience-guides/developer/8f4e3cc2b5d52354a6d43c8edba1e3c9/02_8-bar-reverse.svg" alt="IBM Logo" class="footer__logo themedComponent_node_modules-@docusaurus-theme-common-lib-components-ThemedComponent-styles-module themedComponent--light_node_modules-@docusaurus-theme-common-lib-components-ThemedComponent-styles-module" width="250" height="250"></a>
</div>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>